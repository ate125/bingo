<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Card Generation</title>
  <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .card-container {
            display: inline-block;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            margin: 0 auto;
            background-color: white;
        }
        th, td {
            border: 1px solid #333;
            padding: 10px;
            text-align: center;
            width: 40px;
            height: 40px;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 16px;
        }
        .free-space {
            background-color: blue;
            color: white;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .error {
            color: red;
            margin: 10px;
        }
        #backBtn {
            background-color: #dc3545;
        }
        #backBtn:hover {
            background-color: #c82333;
        }
    #savedCardsContainer {
      position: absolute;
      top: 20px;
      right: 20px;
            width: 300px;
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
            background-color: white;
    }
    #savedCardsContainer h2 {
      font-size: 16px;
      margin-bottom: 5px;
    }
        #cardNumber {
            width: 150px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
    }
  </style>
</head>
<body>
    <h1>Manual Card Generation</h1>
  <p>Enter the numbers for your Bingo card:</p>
    Card Number: <input type="text" id="cardNumber"  placeholder="Enter Card Number"><br><br>
    <div class="card-container">
        <table id="manualCard">
            <tr>
                <th>B</th>
                <th>I</th>
                <th>N</th>
                <th>G</th>
                <th>O</th>
    </tr>
            <!-- Rows will be generated by JavaScript -->
  </table>
    </div>
    <div>
        <button id="generateBtn">Generate Card</button>
  <button id="registerBtn">Register Card</button>
  <button id="backBtn">Back</button>
    </div>
    <div id="errorMessage" class="error"></div>

  <div id="savedCardsContainer">
    <h2>Saved Cards</h2>
    <ul id="savedCardsList"></ul>
  </div>

  <script>
        // Ranges for each column
      const ranges = {
        B: [1, 15],
        I: [16, 30],
        N: [31, 45],
        G: [46, 60],
        O: [61, 75]
      };

        // Generate the card table
        function generateCardTable() {
            const table = document.getElementById('manualCard');
            
            // Create 5 rows
            for (let i = 0; i < 5; i++) {
                const row = table.insertRow();
                for (let j = 0; j < 5; j++) {
                    const cell = row.insertCell();
                    if (i === 2 && j === 2) {
                        // FREE space
                        cell.textContent = 'FREE';
                        cell.classList.add('free-space');
                    } else {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = ranges[Object.keys(ranges)[j]][0];
                        input.max = ranges[Object.keys(ranges)[j]][1];
                        cell.appendChild(input);
                    }
                }
            }
        }

        // Generate random numbers for the card
        function generateRandomCard() {
            const table = document.getElementById('manualCard');
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    if (i === 2 && j === 2) continue; // Skip FREE space
                    const cell = table.rows[i + 1].cells[j];
                    const input = cell.querySelector('input');
                    if (input) {
                        const min = ranges[Object.keys(ranges)[j]][0];
                        const max = ranges[Object.keys(ranges)[j]][1];
                        input.value = Math.floor(Math.random() * (max - min + 1)) + min;
                    }
                }
            }
        }

        // Validate the card
        function validateCard() {
            const table = document.getElementById('manualCard');
            const numbers = [];
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = '';

            // Check for empty fields
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    if (i === 2 && j === 2) continue; // Skip FREE space
                    const cell = table.rows[i + 1].cells[j];
                    const input = cell.querySelector('input');
                    if (!input.value) {
                        errorMessage.textContent = 'Please fill in all numbers!';
                        return false;
                    }
                    numbers.push(parseInt(input.value));
                }
            }

            // Check for duplicates
            const uniqueNumbers = new Set(numbers);
            if (uniqueNumbers.size !== numbers.length) {
                errorMessage.textContent = 'No duplicate numbers allowed!';
                return false;
            }

            return true;
        }

        // Register the card
        function registerCard() {
            if (!validateCard()) return;

            const cardNumberInput = document.getElementById('cardNumber');
            if (!cardNumberInput.value) {
                alert('Please enter a card number!');
                return;
            }

            const table = document.getElementById('manualCard');
            const cardNumbers = [];
        let cardIndex = 0;

            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    if (i === 2 && j === 2) {
                        cardNumbers.push({ number: 'FREE', marked: false });
          } else {
                        const cell = table.rows[i + 1].cells[j];
                        const input = cell.querySelector('input');
                        cardNumbers.push({ number: parseInt(input.value), marked: false });
                    }
            cardIndex++;
          }
            }

            const card = {
                cardNumber: cardNumberInput.value,
                numbers: cardNumbers,
                registeredAt: new Date().toISOString()
            };

            // Send the card data back to the main window
            window.opener.postMessage({
                type: 'registerCard',
                card: card
            }, '*');

            alert('Card registered successfully! Card Number: ' + card.cardNumber);
            window.close();
        }

        // Function to display saved cards
        function displaySavedCards() {
            const savedCards = getSavedCards();
            const savedCardsList = document.getElementById('savedCardsList');
            savedCardsList.innerHTML = ''; // Clear existing list

            savedCards.forEach((card, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    Card Number: ${card.cardNumber}
                    <button onclick="seeCard(${index})">See</button>
                    <button onclick="removeCard(${index})">Remove</button>
                `;
                savedCardsList.appendChild(listItem);
            });
        }

        // Function to get saved cards
        function getSavedCards() {
            const savedCards = localStorage.getItem('registeredCards');
            return savedCards ? JSON.parse(savedCards) : [];
        }

        // Function to remove a card
        function removeCard(index) {
            let savedCards = getSavedCards();
            savedCards.splice(index, 1);
            localStorage.setItem('registeredCards', JSON.stringify(savedCards));
            displaySavedCards();
        }

        // Event listeners
        document.getElementById('generateBtn').addEventListener('click', generateRandomCard);
        document.getElementById('registerBtn').addEventListener('click', registerCard);
        document.getElementById('backBtn').addEventListener('click', function() {
            window.close();
        });

        // Initialize the card table and display saved cards
        generateCardTable();
        displaySavedCards();
  </script>
</body>
</html>